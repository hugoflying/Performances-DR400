<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>DR400-120 – Calculateur de performances</title>
<style>
  :root{--bg:#f6f7fb;--card:#fff;--ink:#0f172a;--muted:#6b7280;--line:#e5e7eb;--primary:#2563eb;--amber:#f59e0b}
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Noto Sans",Arial}
  h1{font-size:clamp(20px,3vw,28px);margin:0}
  h2{font-size:18px;margin:0 0 .6rem}
  .container{max-width:1200px;margin:0 auto;padding:16px}
  .row{display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:1200px){.row{grid-template-columns:repeat(2,1fr)}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.04);position:relative}
  .card.dep{border-left:8px solid var(--primary)}
  .card.arr{border-left:8px solid var(--amber)}
  .btn{border:1px solid var(--line);background:#fff;padding:9px 12px;border-radius:12px;cursor:pointer}
  .btn.primary{background:var(--primary);border-color:var(--primary);color:#fff}
  .btn.toggle.on{background:var(--primary);color:#fff;border-color:var(--primary)}
  label{display:block;font-size:12px;color:var(--muted)}
  input{width:100%;margin-top:6px;padding:10px;border-radius:12px;border:1px solid var(--line);background:#fff}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px}
  .grid1{display:grid;grid-template-columns:1fr;gap:12px}
  .field{border:1px solid var(--line);border-radius:12px;background:#f8fafc;padding:10px}
  .field .k{font-size:12px;color:var(--muted)}
  .field .v{margin-top:4px;font-weight:600}
  .header{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .muted{color:var(--muted)}
  .footer{font-size:12px;color:var(--muted);margin-top:18px}
  .kpi{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--line);border-radius:16px;padding:14px 16px;margin:8px 0}
  .kpi .left{display:flex;flex-direction:column}
  .kpi .title{font-size:12px;color:var(--muted);letter-spacing:.02em}
  .kpi .value{font-size:26px;font-weight:800;line-height:1.1}
  .kpi .sub{font-size:12px;color:var(--muted)}
  .kpi.ok{background:#ecfdf5;border-color:#86efac}
  .kpi.bad{background:#fef2f2;border-color:#fecaca}
  .chip{padding:6px 10px;border-radius:999px;border:1px solid;font-weight:800}
  .chip.ok{background:#dcfce7;color:#14532d;border-color:#86efac}
  .chip.bad{background:#fee2e2;color:#7f1d1d;border-color:#fca5a5}
  .chip.neutral{background:#f3f4f6;color:#374151;border-color:#e5e7eb}
  .runway{width:100%;height:240px;border:1px solid var(--line);border-radius:12px;background:linear-gradient(#f8fafc,#f3f4f6)}
  @media print{.no-print{display:none!important}.container{max-width:none;padding:0}.card{box-shadow:none}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>DR400-120 · Calculateur de performances</h1>
    <div class="no-print" style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn primary" onclick="window.print()">Imprimer</button>
    </div>
  </div>

  <!-- Paramètres globaux -->
  <section class="card" style="margin-top:12px">
    <h2>Paramètres globaux</h2>
    <div class="grid2">
      <label>Marge sécurité (%)<input id="safety" type="number" value="30"/></label>
      <div class="grid1">
        <label>Carénages de roues (Décollage)</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="spatsWith" class="btn toggle on">Avec carénages de roues</button>
          <button id="spatsWithout" class="btn toggle">Sans carénages de roues</button>
        </div>
      </div>
    </div>
  </section>

  <div class="row" style="margin-top:12px">
    <!-- DEPART -->
    <section class="card dep">
      <h2>Terrain de départ</h2>
      <div class="grid2">
        <label>ICAO<input id="depIcao"/></label>
        <label>QFU (°)<input id="depQfu" type="number" value="0"/></label>
        <label>TODA (m)<input id="depToda" type="number" value="0"/></label>
        <div class="grid1">
          <label>Surface piste</label>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="depSurfHard" class="btn toggle on">Dur</button>
            <button id="depSurfGrass" class="btn toggle">Herbe</button>
          </div>
        </div>
      </div>
      <div class="grid2" style="margin-top:10px">
        <label>Élévation (ft)<input id="depAlt" type="number" value="0"/></label>
        <label>OAT (°C)<input id="depOat" type="number" value="15"/></label>
        <label>Vent — Direction (°)<input id="depWindDir" type="number" value="0"/></label>
        <label>Vent — Vitesse (kt)<input id="depWindKt" type="number" value="0"/></label>
      </div>
      <div class="grid3" style="margin-top:10px">
        <div class="field"><div class="k">Vent de face</div><div class="v"><span id="depHwFace">0</span> kt</div></div>
        <div class="field"><div class="k">Vent de travers</div><div class="v"><span id="depXw">0</span> kt</div></div>
        <div class="field"><div class="k">Vent arrière</div><div class="v"><span id="depTw">0</span> kt</div></div>
      </div>
      <div id="depXwWarn" class="muted" style="margin-top:6px"></div>

      <div class="grid2" style="margin-top:10px">
        <label>Facteur suppl. décollage<input id="depExtraTO" type="number" step="0.01" value="1.00"/></label>
        <label>Masse au décollage (kg)<input id="depTow" type="number" value="900"/></label>
      </div>

      <div class="runway" style="margin-top:12px"><svg id="depRunway" width="100%" height="100%"></svg></div>
    </section>

    <!-- ARRIVEE -->
    <section class="card arr">
      <h2>Terrain d’arrivée</h2>
      <div class="grid2">
        <label>ICAO<input id="arrIcao"/></label>
        <label>QFU (°)<input id="arrQfu" type="number" value="0"/></label>
        <label>LDA (m)<input id="arrLda" type="number" value="0"/></label>
        <div class="grid1">
          <label>Surface piste</label>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="arrSurfHard" class="btn toggle on">Dur</button>
            <button id="arrSurfGrass" class="btn toggle">Herbe</button>
          </div>
        </div>
      </div>
      <div class="grid2" style="margin-top:10px">
        <label>Élévation (ft)<input id="arrAlt" type="number" value="0"/></label>
        <label>OAT (°C)<input id="arrOat" type="number" value="15"/></label>
        <label>Vent — Direction (°)<input id="arrWindDir" type="number" value="0"/></label>
        <label>Vent — Vitesse (kt)<input id="arrWindKt" type="number" value="0"/></label>
      </div>
      <div class="grid3" style="margin-top:10px">
        <div class="field"><div class="k">Vent de face</div><div class="v"><span id="arrHwFace">0</span> kt</div></div>
        <div class="field"><div class="k">Vent de travers</div><div class="v"><span id="arrXw">0</span> kt</div></div>
        <div class="field"><div class="k">Vent arrière</div><div class="v"><span id="arrTw">0</span> kt</div></div>
      </div>
      <div id="arrXwWarn" class="muted" style="margin-top:6px"></div>

      <div class="grid2" style="margin-top:10px">
        <label>Facteur suppl. atterrissage<input id="arrExtraLDG" type="number" step="0.01" value="1.00"/></label>
        <label>Masse à l’atterrissage (kg)<input id="arrLdw" type="number" value="900"/></label>
      </div>

      <div style="margin-top:10px">
        <label>Atterrissage — mode</label>
        <div style="display:flex;gap:8px;margin-top:6px;flex-wrap:wrap">
          <button id="arrModerate" class="btn toggle on">Freinage modéré (dur/herbe)</button>
          <button id="arrNoBrake" class="btn toggle">Sans frein sur herbe</button>
        </div>
      </div>

      <div class="runway" style="margin-top:12px"><svg id="arrRunway" width="100%" height="100%"></svg></div>
    </section>
  </div>

  <!-- Résultats -->
  <div class="row" style="margin-top:16px">
    <div class="card dep">
      <div class="header">
        <h2>Décollage</h2><span id="toChip" class="chip neutral">—</span>
      </div>
      <div id="toKpi" class="kpi">
        <div class="left"><span class="title">Requis (marge incluse)</span><span class="value" id="toKpiVal">— m</span><span class="sub">TODA dispo : <span id="todaMini">—</span></span></div>
      </div>
      <div class="grid2" style="margin-top:8px">
        <div class="field"><div class="k">Base (passage 15 m)</div><div id="toBasePass" class="v">—</div></div>
        <div class="field"><div class="k">Roulement (info)</div><div id="toBaseRoll" class="v">—</div></div>
        <div class="field"><div class="k">Facteur vent</div><div id="toWindF" class="v">—</div></div>
        <div class="field"><div class="k">Carénages</div><div id="toSpat" class="v">—</div></div>
        <div class="field"><div class="k">Facteur supplémentaire</div><div id="toExtra" class="v">—</div></div>
        <div class="field"><div class="k">Résultat (sans marge)</div><div id="toRes" class="v">—</div></div>
        <div class="field"><div class="k">+ Marge</div><div id="toResM" class="v">—</div></div>
      </div>
    </div>

    <div class="card arr">
      <div class="header">
        <h2>Atterrissage</h2><span id="ldgChip" class="chip neutral">—</span>
      </div>
      <div id="ldgKpi" class="kpi">
        <div class="left"><span class="title">Requis (marge incluse)</span><span class="value" id="ldgKpiVal">— m</span><span class="sub">LDA dispo : <span id="ldaMini">—</span></span></div>
      </div>
      <div class="grid2" style="margin-top:8px">
        <div class="field"><div class="k">Base (passage 15 m)</div><div id="ldgBasePass" class="v">—</div></div>
        <div class="field"><div class="k">Roulement (info)</div><div id="ldgBaseRoll" class="v">—</div></div>
        <div class="field"><div class="k">Facteur vent</div><div id="ldgWindF" class="v">—</div></div>
        <div class="field"><div class="k">Facteur supplémentaire</div><div id="ldgExtra" class="v">—</div></div>
        <div class="field"><div class="k">Résultat (sans marge)</div><div id="ldgRes" class="v">—</div></div>
        <div class="field"><div class="k">+ Marge</div><div id="ldgResM" class="v">—</div></div>
      </div>
    </div>
  </div>

  <div class="footer">
    Sources : Manuel de vol DR400-120 (STD±20). Vent face (10→0,78 · 20→0,63 · 30→0,52). Vent arrière : +10 % par tranche de 2 kt. Bulletin ROBIN « Sans carénages » : +3 % (décollage 15 m).
  </div>
</div>

<script>
/* ----- Tables perf (1979) ----- */
const TO_TABLE={0:{temps:{minus20:-5,isa:15,plus20:35},hard:{kg700:{roll:[130,145,165],pass:[285,315,345]},kg900:{roll:[225,235,285],pass:[480,535,590]}},grass:{kg700:{roll:[165,185,215],pass:[320,355,395]},kg900:{roll:[315,360,410],pass:[570,640,715]}}},4000:{temps:{minus20:-13,isa:7,plus20:27},hard:{kg700:{roll:[175,195,220],pass:[375,415,460]},kg900:{roll:[305,345,390],pass:[645,720,800]}},grass:{kg700:{roll:[230,265,300],pass:[430,485,540]},kg900:{roll:[460,530,615],pass:[800,905,1025]}}},8000:{temps:{minus20:-21,isa:-1,plus20:19},hard:{kg700:{roll:[235,265,300],pass:[500,560,620]},kg900:{roll:[425,475,535],pass:[890,1000,1125]}},grass:{kg700:{roll:[330,380,440],pass:[595,675,760]},kg900:{roll:[700,820,960],pass:[1165,1350,1550]}}}};
const LDG_TABLE={0:{temps:{minus20:-5,isa:15,plus20:35},moderate:{kg700:{roll:[145,155,165],pass:[365,385,400]},kg900:{roll:[185,200,210],pass:[435,460,485]}},nobrake_grass:{kg700:{roll:[215,230,250],pass:[435,460,485]},kg900:{roll:[280,300,325],pass:[530,560,590]}}},4000:{temps:{minus20:-13,isa:7,plus20:27},moderate:{kg700:{roll:[160,175,185],pass:[395,420,440]},kg900:{roll:[205,225,240],pass:[475,505,535]}},nobrake_grass:{kg700:{roll:[240,260,285],pass:[475,505,530]},kg900:{roll:[310,335,360],pass:[580,615,655]}}},8000:{temps:{minus20:-21,isa:-1,plus20:19},moderate:{kg700:{roll:[180,195,210],pass:[430,460,485]},kg900:{roll:[235,250,270],pass:[525,555,590]}},nobrake_grass:{kg700:{roll:[275,290,315],pass:[525,555,590]},kg900:{roll:[350,375,405],pass:[640,680,725]}}}};

/* ----- Utils ----- */
const $=s=>document.querySelector(s);
const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));
const lerp=(x0,y0,x1,y1,x)=>y0+(y1-y0)*((x-x0)/(x1-x0||1));
function interpTemp(rowTemps,arr,oat){const xs=[rowTemps.minus20,rowTemps.isa,rowTemps.plus20],ys=arr;if(oat<=xs[0])return ys[0];if(oat>=xs[2])return ys[2];if(oat<=xs[1])return lerp(xs[0],ys[0],xs[1],ys[1],oat);return lerp(xs[1],ys[1],xs[2],ys[2],oat)}
function interpTO(alt,oat,mass,surf,kind){const low=alt<=0?0:alt>=8000?8000:(alt<=4000?0:4000),high=alt<=0?0:alt>=8000?8000:(alt<=4000?4000:8000),a=clamp((mass-700)/(900-700),0,1),valAt=al=>{const t=TO_TABLE[al];const v700=interpTemp(t.temps,t[surf].kg700[kind],oat);const v900=interpTemp(t.temps,t[surf].kg900[kind],oat);return lerp(0,v700,1,v900,a)};if(low===high)return valAt(low);return lerp(low,valAt(low),high,valAt(high),alt)}
function interpLDG(alt,oat,mass,mode,kind){const low=alt<=0?0:alt>=8000?8000:(alt<=4000?0:4000),high=alt<=0?0:alt>=8000?8000:(alt<=4000?4000:8000),a=clamp((mass-700)/(900-700),0,1),valAt=al=>{const t=LDG_TABLE[al];const v700=interpTemp(t.temps,t[mode].kg700[kind],oat);const v900=interpTemp(t.temps,t[mode].kg900[kind],oat);return lerp(0,v700,1,v900,a)};if(low===high)return valAt(low);return lerp(low,valAt(low),high,valAt(high),alt)}
function windComponents(qfu,windDir,windKt){const diff=((windDir-qfu+540)%360)-180;const rad=diff*Math.PI/180;return{headwind:windKt*Math.cos(rad),crosswind:windKt*Math.sin(rad),diff}}
function headwindFactorFace(hw){const pts=[{x:0,y:1.00},{x:10,y:0.78},{x:20,y:0.63},{x:30,y:0.52}],x=clamp(hw,0,30);if(x===0)return 1;for(let i=0;i<pts.length-1;i++){const p0=pts[i],p1=pts[i+1];if(x>=p0.x&&x<=p1.x)return lerp(p0.x,p0.y,p1.x,p1.y,x)}return pts[pts.length-1].y}
function windDistanceFactor(hw){if(hw>=0)return headwindFactorFace(hw);const tw=Math.abs(hw);const steps=Math.ceil(tw/2);return 1+0.10*steps}
function setChip(el,state){el.className='chip '+(state==='ok'?'ok':state==='bad'?'bad':'neutral');el.textContent=state==='ok'?'OK':state==='bad'?'KO':'—'}
function setKpi(el,state){el.className='kpi '+(state==='ok'?'ok':state==='bad'?'bad':'')}
function status(val,limit){if(!limit)return'neutral';return val<=limit?'ok':'bad'}

/* ----- State & events ----- */
let depSurface='hard',arrSurface='hard',landingMode='moderate',withSpats=true;
['safety','depIcao','depQfu','depToda','depAlt','depOat','depWindDir','depWindKt','depExtraTO','depTow','arrIcao','arrQfu','arrLda','arrAlt','arrOat','arrWindDir','arrWindKt','arrExtraLDG','arrLdw'].forEach(id=>$('#'+id).addEventListener('input',compute));
$('#depSurfHard').onclick=()=>{depSurface='hard';toggleBtns('#depSurfHard','#depSurfGrass');compute()};
$('#depSurfGrass').onclick=()=>{depSurface='grass';toggleBtns('#depSurfGrass','#depSurfHard');compute()};
$('#arrSurfHard').onclick=()=>{arrSurface='hard';toggleBtns('#arrSurfHard','#arrSurfGrass');compute()};
$('#arrSurfGrass').onclick=()=>{arrSurface='grass';toggleBtns('#arrSurfGrass','#arrSurfHard');compute()};
$('#arrModerate').onclick=()=>{landingMode='moderate';toggleBtns('#arrModerate','#arrNoBrake');compute()};
$('#arrNoBrake').onclick=()=>{landingMode='nobrake_grass';toggleBtns('#arrNoBrake','#arrModerate');compute()};
$('#spatsWith').onclick=()=>{withSpats=true;toggleBtns('#spatsWith','#spatsWithout');compute()};
$('#spatsWithout').onclick=()=>{withSpats=false;toggleBtns('#spatsWithout','#spatsWith');compute()};
function toggleBtns(onSel,offSel){$(onSel).classList.add('on');$(offSel).classList.remove('on')}

/* ----- Runway drawing (SVG) ----- */
function drawRunway(svgId,{available,required,ok,label,qfu,windDir,windKt,diffDeg}){
  const svg=$(svgId); if(!svg) return; const w=svg.clientWidth||320,h=svg.clientHeight||240;
  svg.innerHTML='';
  const ns='http://www.w3.org/2000/svg';
  const add=(tag,attrs)=>{const el=document.createElementNS(ns,tag);Object.entries(attrs).forEach(([k,v])=>el.setAttribute(k,String(v)));svg.appendChild(el);return el}
  // Background
  add('rect',{x:0,y:0,width:w,height:h,fill:'transparent'});
  // Runway
  const rx=w*0.6, rw=w*0.18, ry=h*0.08, rh=h*0.84;
  add('rect',{x:rx,y:ry,width:rw,height:rh,fill:'#111',rx:8});
  // Centerline
  const dashH=12, gap=10; for(let y=ry+8;y<ry+rh-8;y+=dashH+gap){add('rect',{x:rx+rw/2-2,y,width:4,height:dashH,fill:'#fff'})}
  // Threshold strips
  for(let i=0;i<6;i++){add('rect',{x:rx+6+i*10,y:ry+rh-16,width:6,height:10,fill:'#fff'})}
  // Scale/labels
  add('text',{x:rx+rw+8,y:ry+12,fill:'#334155','font-size':'12','font-family':'system-ui'}).textContent=label+' : '+(available?available+' m':'—');
  // Used bar (required)
  if(available>0 && required>0){
    const ratio=Math.min(required/available,1.2); // cap 120% for display
    const used=ratio*rh;
    add('rect',{x:rx-16,y:ry+rh-used,width:10,height:used,fill:ok?'#16a34a':'#dc2626',rx:4});
    add('text',{x:rx-18,y:ry+rh-used-6,fill:ok?'#16a34a':'#dc2626','font-size':'12','text-anchor':'end','font-family':'system-ui'}).textContent=required+' m';
  }
  // Windsock (relative to runway axis)
  const g=document.createElementNS(ns,'g'); g.setAttribute('transform',`translate(${rx+rw+40},${ry+rh/2}) rotate(${-diffDeg})`); svg.appendChild(g);
  const addG=(tag,attrs)=>{const el=document.createElementNS(ns,tag);Object.entries(attrs).forEach(([k,v])=>el.setAttribute(k,String(v)));g.appendChild(el);return el}
  addG('rect',{x:-2,y:-40,width:4,height:80,fill:'#6b7280'}); // pole
  // sock body (5 segments)
  const segs=[[0,-30,30,12],[30,-26,20,10],[50,-22,16,9],[66,-19,12,8],[78,-16,8,7]];
  segs.forEach((s,i)=>addG('rect',{x:s[0],y:s[1],width:s[2],height:s[3],fill:i%2? '#ffffff' : '#f97316',rx:2}))
  // wind text
  add('text',{x:rx+rw+8,y:ry+rh/2+50,fill:'#334155','font-size':'12','font-family':'system-ui'}).textContent=`${windDir}° / ${windKt} kt`;
}

/* ----- Compute ----- */
function compute(){
  const safety=Number($('#safety').value||30);

  // DEP
  const depQfu=Number($('#depQfu').value||0), depToda=Number($('#depToda').value||0);
  const depAlt=Number($('#depAlt').value||0), depOat=Number($('#depOat').value||0);
  const depWdir=Number($('#depWindDir').value||0), depWkt=Number($('#depWindKt').value||0);
  const depExtra=Number($('#depExtraTO').value||1), depTow=Number($('#depTow').value||900);

  // ARR
  const arrQfu=Number($('#arrQfu').value||0), arrLda=Number($('#arrLda').value||0);
  const arrAlt=Number($('#arrAlt').value||0), arrOat=Number($('#arrOat').value||0);
  const arrWdir=Number($('#arrWindDir').value||0), arrWkt=Number($('#arrWindKt').value||0);
  const arrExtra=Number($('#arrExtraLDG').value||1), arrLdw=Number($('#arrLdw').value||900);

  // Winds
  const depComp=windComponents(depQfu,depWdir,depWkt);
  const arrComp=windComponents(arrQfu,arrWdir,arrWkt);
  const depHw=depComp.headwind, depXw=Math.abs(depComp.crosswind), depHwFace=Math.max(0,depHw), depTw=Math.max(0,-depHw);
  const arrHw=arrComp.headwind, arrXw=Math.abs(arrComp.crosswind), arrHwFace=Math.max(0,arrHw), arrTw=Math.max(0,-arrHw);
  $('#depHwFace').textContent=depHwFace.toFixed(0); $('#depXw').textContent=depXw.toFixed(0); $('#depTw').textContent=depTw.toFixed(0);
  $('#arrHwFace').textContent=arrHwFace.toFixed(0); $('#arrXw').textContent=arrXw.toFixed(0); $('#arrTw').textContent=arrTw.toFixed(0);
  const crossLimit=22; const depWarn=$('#depXwWarn'), arrWarn=$('#arrXwWarn');
  depWarn.textContent=depXw>crossLimit?`⚠️ ${depXw.toFixed(0)} kt > ${crossLimit} kt (limite DR400)`:''; depWarn.style.color=depXw>crossLimit?'#dc2626':'var(--muted)';
  arrWarn.textContent=arrXw>crossLimit?`⚠️ ${arrXw.toFixed(0)} kt > ${crossLimit} kt (limite DR400)`:''; arrWarn.style.color=arrXw>crossLimit?'#dc2626':'var(--muted)';

  // Interpolations
  const baseTO_pass=interpTO(depAlt,depOat,depTow,depSurface,'pass');
  const baseTO_roll=interpTO(depAlt,depOat,depTow,depSurface,'roll');
  const baseLDG_pass=interpLDG(arrAlt,arrOat,arrLdw,landingMode,'pass');
  const baseLDG_roll=interpLDG(arrAlt,arrOat,arrLdw,landingMode,'roll');

  const depWindF=windDistanceFactor(depHw);
  const arrWindF=windDistanceFactor(arrHw);
  const spatsF=withSpats?1.00:1.03;

  const toCalc=Math.round(baseTO_pass*depWindF*depExtra*spatsF);
  const ldgCalc=Math.round(baseLDG_pass*arrWindF*arrExtra);
  const toMargin=Math.round(toCalc*(1+safety/100));
  const ldgMargin=Math.round(ldgCalc*(1+safety/100));

  // Résultats
  $('#toBasePass').textContent=Math.round(baseTO_pass)+' m';
  $('#toBaseRoll').textContent=Math.round(baseTO_roll)+' m';
  $('#toWindF').textContent=depWindF.toFixed(2)+'×';
  $('#toSpat').textContent=`${spatsF.toFixed(2)}×`+(withSpats?' (carénages présents)':' (sans carénages)');
  $('#toExtra').textContent=depExtra.toFixed(2)+'×';
  $('#toRes').textContent=toCalc+' m';
  $('#toResM').textContent=toMargin+' m';
  $('#todaMini').textContent=depToda?depToda+' m':'—';

  $('#ldgBasePass').textContent=Math.round(baseLDG_pass)+' m';
  $('#ldgBaseRoll').textContent=Math.round(baseLDG_roll)+' m';
  $('#ldgWindF').textContent=arrWindF.toFixed(2)+'×';
  $('#ldgExtra').textContent=arrExtra.toFixed(2)+'×';
  $('#ldgRes').textContent=ldgCalc+' m';
  $('#ldgResM').textContent=ldgMargin+' m';
  $('#ldaMini').textContent=arrLda?arrLda+' m':'—';

  const stTO=status(toMargin,depToda), stLDG=status(ldgMargin,arrLda);
  setChip($('#toChip'),stTO); setChip($('#ldgChip'),stLDG); setKpi($('#toKpi'),stTO); setKpi($('#ldgKpi'),stLDG);
  $('#toKpiVal').textContent=toMargin+' m'; $('#ldgKpiVal').textContent=ldgMargin+' m';

  // Dessins piste + manche à air
  drawRunway('#depRunway',{available:depToda,required:toMargin,ok:stTO==='ok',label:'TODA',qfu:depQfu,windDir:depWdir,windKt:depWkt,diffDeg:depComp.diff});
  drawRunway('#arrRunway',{available:arrLda,required:ldgMargin,ok:stLDG==='ok',label:'LDA',qfu:arrQfu,windDir:arrWdir,windKt:arrWkt,diffDeg:arrComp.diff});
}
compute();
</script>
</body>
</html>
